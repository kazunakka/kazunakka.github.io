<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON â‡” ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ å¤‰æ›ãƒ„ãƒ¼ãƒ« - Still Time</title>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Kalam', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #66b2b2, #8cc5c5);
      min-height: 100vh;
      padding: 24px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header {
      background: white;
      border: 2px solid #66b2b2;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(51, 102, 102, 0.2);
      padding: 24px;
      margin-bottom: 24px;
    }
    
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 8px;
    }
    
    h1 {
      font-size: 1.875rem;
      font-weight: 700;
      color: #336666;
    }
    
    .switch-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: #66b2b2;
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-family: 'Kalam', sans-serif;
      box-shadow: 0 2px 8px rgba(102, 178, 178, 0.3);
      transition: all 0.3s ease;
    }
    
    .switch-btn:hover {
      background: #4d8a8a;
      box-shadow: 0 4px 12px rgba(102, 178, 178, 0.4);
      transform: translateY(-2px);
    }
    
    .subtitle {
      color: #336666;
      margin-bottom: 16px;
      font-size: 16px;
    }
    
    .privacy-box {
      padding: 16px;
      background: #b3d6d6;
      border: 1px solid #8cc5c5;
      border-radius: 12px;
    }
    
    .privacy-title {
      font-size: 14px;
      font-weight: 700;
      color: #336666;
      margin-bottom: 4px;
    }
    
    .privacy-text {
      font-size: 14px;
      color: #336666;
    }
    
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    
    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
    
    .card {
      background: white;
      border: 2px solid #66b2b2;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(51, 102, 102, 0.2);
      padding: 24px;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    h2 {
      font-size: 1.25rem;
      font-weight: 700;
      color: #336666;
    }
    
    .example-btn {
      font-size: 14px;
      color: #66b2b2;
      background: none;
      border: none;
      cursor: pointer;
      font-family: 'Kalam', sans-serif;
    }
    
    .example-btn:hover {
      color: #4d8a8a;
      text-decoration: underline;
    }
    
    textarea {
      width: 100%;
      height: 256px;
      padding: 12px;
      border: 2px solid #8cc5c5;
      border-radius: 8px;
      font-family: monospace;
      font-size: 14px;
      resize: vertical;
      transition: border-color 0.3s ease;
    }
    
    textarea:focus {
      outline: none;
      border-color: #66b2b2;
      box-shadow: 0 0 0 3px rgba(102, 178, 178, 0.1);
    }
    
    textarea[readonly] {
      background: #f9fafb;
    }
    
    .convert-btn {
      width: 100%;
      margin-top: 16px;
      padding: 12px;
      background: #66b2b2;
      color: white;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      font-family: 'Kalam', sans-serif;
      box-shadow: 0 2px 8px rgba(102, 178, 178, 0.3);
      transition: all 0.3s ease;
    }
    
    .convert-btn:hover {
      background: #4d8a8a;
      box-shadow: 0 4px 12px rgba(102, 178, 178, 0.4);
      transform: translateY(-2px);
    }
    
    .error-box {
      margin-top: 16px;
      padding: 12px;
      background: #fef2f2;
      border: 2px solid #d17e83;
      border-radius: 12px;
      color: #991b1b;
      font-size: 14px;
    }
    
    .button-group {
      display: flex;
      gap: 8px;
    }
    
    .action-btn {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 14px;
      border: none;
      border-radius: 25px;
      font-size: 14px;
      cursor: pointer;
      color: white;
      font-family: 'Kalam', sans-serif;
      transition: all 0.3s ease;
    }
    
    .copy-btn {
      background: #66b2b2;
      box-shadow: 0 2px 6px rgba(102, 178, 178, 0.3);
    }
    
    .copy-btn:hover {
      background: #4d8a8a;
      transform: translateY(-1px);
    }
    
    .download-btn {
      background: #8cc5c5;
      color: #336666;
      box-shadow: 0 2px 6px rgba(140, 197, 197, 0.3);
    }
    
    .download-btn:hover {
      background: #66b2b2;
      color: white;
      transform: translateY(-1px);
    }
    
    .info-box {
      margin-top: 16px;
      padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      border: 2px solid;
    }
    
    .info-box-blue {
      background: #e6f4f4;
      border-color: #8cc5c5;
      color: #336666;
    }
    
    .info-box-teal {
      background: #b3d6d6;
      border-color: #66b2b2;
      color: #336666;
    }
    
    .info-box strong {
      display: block;
      margin-bottom: 8px;
      font-weight: 700;
    }
    
    .info-box ol {
      margin-left: 20px;
      margin-top: 8px;
    }
    
    .info-box li {
      margin: 4px 0;
    }
    
    .features {
      background: white;
      border: 2px solid #66b2b2;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(51, 102, 102, 0.2);
      padding: 24px;
    }
    
    h3 {
      font-size: 1.125rem;
      font-weight: 700;
      color: #336666;
      margin-bottom: 12px;
    }
    
    .features-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    @media (max-width: 768px) {
      .features-grid {
        grid-template-columns: 1fr;
      }
      h1 {
        font-size: 1.5rem;
      }
    }
    
    h4 {
      font-weight: 700;
      color: #336666;
      margin-bottom: 8px;
    }
    
    .features ul {
      list-style: none;
    }
    
    .features li {
      color: #2D2D2D;
      font-size: 14px;
      margin: 4px 0;
    }
    
    .footer {
      text-align: center;
      margin-top: 24px;
      color: #336666;
      font-size: 14px;
    }
    
    .footer a {
      color: #336666;
      font-weight: 700;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    const { useState, createElement: h } = React;

    function JsonSheetsConverter() {
      const [mode, setMode] = useState('toSheets');
      const [input, setInput] = useState('');
      const [output, setOutput] = useState('');
      const [error, setError] = useState('');
      const [copied, setCopied] = useState(false);

      const parseJson = (jsonStr) => {
        try {
          return JSON.parse(jsonStr);
        } catch (e) {
          throw new Error('ç„¡åŠ¹ãªJSONå½¢å¼ã§ã™: ' + e.message);
        }
      };

      const flattenObject = (obj, prefix = '') => {
        const flattened = {};
        for (const key in obj) {
          const value = obj[key];
          const newKey = prefix ? prefix + '.' + key : key;
          if (value === null || value === undefined) {
            flattened[newKey] = '';
          } else if (typeof value === 'object' && !Array.isArray(value)) {
            Object.assign(flattened, flattenObject(value, newKey));
          } else if (Array.isArray(value)) {
            flattened[newKey] = JSON.stringify(value);
          } else {
            flattened[newKey] = value;
          }
        }
        return flattened;
      };

      const convertJsonToTsv = () => {
        setError('');
        setOutput('');
        setCopied(false);
        try {
          const data = parseJson(input);
          let rows = [];
          if (Array.isArray(data)) {
            if (data.length === 0) throw new Error('ç©ºã®é…åˆ—ã§ã™');
            rows = data.map(item => flattenObject(item));
          } else if (typeof data === 'object') {
            rows = [flattenObject(data)];
          } else {
            throw new Error('ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¾ãŸã¯é…åˆ—ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
          }
          const allKeys = [...new Set(rows.flatMap(row => Object.keys(row)))];
          const header = allKeys.join('\t');
          const dataRows = rows.map(row => 
            allKeys.map(key => String(row[key] ?? '').replace(/\t/g, ' ')).join('\t')
          );
          setOutput([header, ...dataRows].join('\n'));
        } catch (e) {
          setError(e.message);
        }
      };

      const convertTsvToJson = () => {
        setError('');
        setOutput('');
        setCopied(false);
        try {
          if (!input.trim()) throw new Error('ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          const lines = input.trim().split('\n');
          if (lines.length < 2) throw new Error('ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã¨ãƒ‡ãƒ¼ã‚¿è¡ŒãŒå¿…è¦ã§ã™');
          const headers = lines[0].split('\t').map(h => h.trim());
          const jsonArray = [];
          for (let i = 1; i < lines.length; i++) {
            const values = lines[i].split('\t');
            const obj = {};
            headers.forEach((header, index) => {
              let value = values[index] || '';
              if (value && !isNaN(value) && value.trim() !== '') {
                value = Number(value);
              }
              if (header.includes('.')) {
                const parts = header.split('.');
                let current = obj;
                for (let j = 0; j < parts.length - 1; j++) {
                  if (!current[parts[j]]) current[parts[j]] = {};
                  current = current[parts[j]];
                }
                current[parts[parts.length - 1]] = value;
              } else {
                obj[header] = value;
              }
            });
            jsonArray.push(obj);
          }
          setOutput(JSON.stringify(jsonArray));
        } catch (e) {
          setError(e.message);
        }
      };

      const handleConvert = () => {
        mode === 'toSheets' ? convertJsonToTsv() : convertTsvToJson();
      };

      const copyToClipboard = async () => {
        try {
          await navigator.clipboard.writeText(output);
          setCopied(true);
          setTimeout(() => setCopied(false), 2000);
        } catch (e) {
          alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      };

      const downloadFile = () => {
        const ext = mode === 'toSheets' ? 'tsv' : 'json';
        const type = mode === 'toSheets' ? 'text/tab-separated-values' : 'application/json';
        const blob = new Blob([output], { type });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'data.' + ext;
        a.click();
        URL.revokeObjectURL(url);
      };

      const exampleJson = '[{"date":"2026-01-06T08:00:00.000000","durationMinutes":10,"mood":5,"memo":"æœã®ç‘æƒ³ã€‚æ°—åˆ†çˆ½å¿«ã€‚"},{"date":"2026-01-05T20:30:00.000000","durationMinutes":5,"mood":4,"memo":"å¯ã‚‹å‰ã®ãƒªãƒ©ãƒƒã‚¯ã‚¹ã€‚"}]';
      const exampleTsv = 'date\tdurationMinutes\tmood\tmemo\n2026-01-06T08:00:00.000000\t10\t5\tæœã®ç‘æƒ³ã€‚æ°—åˆ†çˆ½å¿«ã€‚\n2026-01-05T20:30:00.000000\t5\t4\tå¯ã‚‹å‰ã®ãƒªãƒ©ãƒƒã‚¯ã‚¹ã€‚';

      const loadExample = () => {
        setInput(mode === 'toSheets' ? exampleJson : exampleTsv);
        setOutput('');
        setError('');
      };

      const switchMode = () => {
        setMode(mode === 'toSheets' ? 'toJson' : 'toSheets');
        setInput('');
        setOutput('');
        setError('');
        setCopied(false);
      };

      return h('div', { className: 'container' },
        h('div', { className: 'header' },
          h('div', { className: 'header-top' },
            h('h1', null, 'JSON â‡” ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ å¤‰æ›ãƒ„ãƒ¼ãƒ«'),
            h('button', { className: 'switch-btn', onClick: switchMode }, 'â‡„ å¤‰æ›æ–¹å‘ã‚’åˆ‡ã‚Šæ›¿ãˆ')
          ),
          h('p', { className: 'subtitle' },
            mode === 'toSheets' ? 'JSONæ–‡å­—åˆ—ã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå½¢å¼ã«å¤‰æ›' : 'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã«å¤‰æ›'
          ),
          h('div', { className: 'privacy-box' },
            h('p', { className: 'privacy-title' }, 'ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·'),
            h('p', { className: 'privacy-text' },
              'ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å®Œçµã—ã¦å‹•ä½œã—ã¾ã™ã€‚å…¥åŠ›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¯ä¸€åˆ‡ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œãšã€ãŠä½¿ã„ã®ãƒ‡ãƒã‚¤ã‚¹å†…ã§ã®ã¿å‡¦ç†ã•ã‚Œã¾ã™ã€‚å®‰å¿ƒã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚'
            )
          )
        ),
        h('div', { className: 'grid' },
          h('div', { className: 'card' },
            h('div', { className: 'card-header' },
              h('h2', null, mode === 'toSheets' ? 'JSONå…¥åŠ›' : 'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›'),
              h('button', { className: 'example-btn', onClick: loadExample }, 'ã‚µãƒ³ãƒ—ãƒ«ã‚’èª­ã¿è¾¼ã‚€')
            ),
            h('textarea', {
              value: input,
              onChange: (e) => setInput(e.target.value),
              placeholder: mode === 'toSheets' ? 'JSONãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„' : 'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„'
            }),
            h('button', { className: 'convert-btn', onClick: handleConvert }, 'å¤‰æ›ã™ã‚‹'),
            error && h('div', { className: 'error-box' }, error)
          ),
          h('div', { className: 'card' },
            h('div', { className: 'card-header' },
              h('h2', null, 'å¤‰æ›çµæœ'),
              output && h('div', { className: 'button-group' },
                h('button', { className: 'action-btn copy-btn', onClick: copyToClipboard },
                  copied ? 'âœ“ ã‚³ãƒ”ãƒ¼æ¸ˆã¿' : 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'
                ),
                h('button', { className: 'action-btn download-btn', onClick: downloadFile },
                  'â¬‡ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰'
                )
              )
            ),
            h('textarea', { value: output, readOnly: true, placeholder: 'ã“ã“ã«å¤‰æ›çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™' }),
            output && mode === 'toSheets' && h('div', { className: 'info-box info-box-blue' },
              h('strong', null, 'ä½¿ã„æ–¹:'),
              h('ol', null,
                h('li', null, 'ã€Œã‚³ãƒ”ãƒ¼ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯'),
                h('li', null, 'Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã'),
                h('li', null, 'ã‚»ãƒ«A1ã‚’é¸æŠã—ã¦è²¼ã‚Šä»˜ã‘ï¼ˆCtrl+V / Cmd+Vï¼‰')
              )
            ),
            output && mode === 'toJson' && h('div', { className: 'info-box info-box-teal' },
              h('strong', null, 'ä½¿ã„æ–¹:'),
              h('ol', null,
                h('li', null, 'Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§ãƒ‡ãƒ¼ã‚¿ç¯„å›²ã‚’é¸æŠ'),
                h('li', null, 'ã‚³ãƒ”ãƒ¼ï¼ˆCtrl+C / Cmd+Cï¼‰'),
                h('li', null, 'å·¦å´ã®ãƒœãƒƒã‚¯ã‚¹ã«è²¼ã‚Šä»˜ã‘'),
                h('li', null, 'ã€Œå¤‰æ›ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯')
              )
            )
          )
        ),
        h('div', { className: 'features' },
          h('h3', null, 'æ©Ÿèƒ½'),
          h('div', { className: 'features-grid' },
            h('div', null,
              h('h4', null, 'JSON â†’ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ'),
              h('ul', null,
                h('li', null, 'âœ“ JSONé…åˆ—ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¡¨å½¢å¼ã«å¤‰æ›'),
                h('li', null, 'âœ“ ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ•ãƒ©ãƒƒãƒˆåŒ–'),
                h('li', null, 'âœ“ Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ç›´æ¥è²¼ã‚Šä»˜ã‘å¯èƒ½')
              )
            ),
            h('div', null,
              h('h4', null, 'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ â†’ JSON'),
              h('ul', null,
                h('li', null, 'âœ“ ã‚³ãƒ”ãƒ¼ã—ãŸã‚»ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’JSONé…åˆ—ã«å¤‰æ›'),
                h('li', null, 'âœ“ æ•°å€¤ã®è‡ªå‹•åˆ¤å®š'),
                h('li', null, 'âœ“ ãƒã‚¹ãƒˆã•ã‚ŒãŸæ§‹é€ ã®å¾©å…ƒ')
              )
            )
          )
        ),
        h('div', { className: 'footer' },
          h('p', null, 'Still Time ã‚µãƒãƒ¼ãƒˆãƒ„ãƒ¼ãƒ«')
        )
      );
    }

    ReactDOM.render(React.createElement(JsonSheetsConverter), document.getElementById('root'));
  </script>
</body>
</html>